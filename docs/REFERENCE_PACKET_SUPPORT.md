# Reference Packet Support Analysis

This document summarizes which reference packets are populated from PCAPs and what the client/server can generate or handle.

## Current Reference Packets (Real-World Captures)

Reference extraction uses all PCAPs under `pcaps/` and only accepts little-endian ENIP headers for reference data.
The latest extraction run produced 64 reference packets (duplicates across files collapsed into the reference library).

Populated:
- RegisterSession_Request
- ListIdentity_Request
- GetAttributeSingle_Request
- GetAttributeSingle_Response
- SetAttributeSingle_Request
- SetAttributeSingle_Response
- ForwardOpen_Request
- ForwardOpen_Response
- ForwardClose_Request
- ForwardClose_Response
- SendUnitData_Request

Missing (real-world reference sample not yet captured):
- RegisterSession_Response

Baseline captures are used for regression only and are not considered compliance sources of truth.

## How This Analysis Is Produced

- `cipdip pcap-summary --input pcaps/stress/ENIP.pcap` for single-file service/path counts.
- `cipdip pcap-report --pcap-dir pcaps --output notes/pcap_summary_report.md` for multi-PCAP summaries.
- `cipdip extract-reference --real-world-dir pcaps --output internal/cipclient/reference_packets_gen.go` for reference packet population.

## Client Support Summary

The client can generate all listed request types and uses them across scenarios:
- RegisterSession (Connect)
- SendRRData for Get/Set Attribute Single
- ForwardOpen/ForwardClose for I/O scenarios
- SendUnitData for I/O data exchange
- ListIdentity for discovery

## Server Support Summary

The server handles and responds to the same request types via its adapter/logix_like personalities.

## Notes

- Reference extraction is intentionally strict to avoid polluted samples.
- Missing references are treated as test coverage gaps, not protocol support limitations.
- PCAP summary now labels Rockwell tag services (0x4B/0x4C/0x4D) and Unconnected Send (0x52) with class-aware mapping, and reports embedded CIP services.

## Latest PCAP Summary (pcaps/stress/ENIP.pcap)

Generated by:
`cipdip pcap-summary --input pcaps/stress/ENIP.pcap`
Generated at (UTC): `2026-01-02T02:28:10Z`

```
PCAP Summary:
  Total packets: 400688
  ENIP packets: 92869
  Requests: 67647
  Responses: 25222
  CPF used: 91479
  CPF missing: 193
  CIP requests: 24838
  CIP responses: 24730
  CIP payloads (UCMM): 49568
  I/O payloads (connected): 41911
  EPATH 16-bit class: 0
  EPATH 16-bit instance: 0
  EPATH 16-bit attribute: 0
  CIP path size used: 24838
  CIP path size missing: 0
  Vendor ID: 0x0001
  Product Name: 1756-ENBT/A

Command Counts:
  SendRRData: 49667
  SendUnitData: 42005
  ListIdentity: 826
  ListServices: 102
  RegisterSession: 96
  ListInterfaces: 93
  UnregisterSession: 80

CIP Service Counts:
  Execute_PCCC: 13992
  Execute_PCCC_Response: 13895
  Write_Tag: 10491
  Write_Tag_Response: 10491
  Unconnected_Send: 279
  Get_Attribute_All_Response: 256
  Forward_Open: 32
  Forward_Open_Response: 29
  Forward_Close: 27
  Read_Modify_Write_Response: 27
  Get_Attribute_List_Response: 25
  Get_Attribute_All: 9
  Get_Attribute_Single: 3
  Get_Attribute_Single_Response: 3
  Unknown(0x4B): 2
  Unknown(0x51): 2
  Unknown(0x51)_Response: 2
  Reset: 1
  Reset_Response: 1
  Set_Attribute_Single_Response: 1

Embedded CIP Service Counts:
  Get_Attribute_All: 254
  Get_Attribute_List: 25

Unknown CIP Service Details:
  Unknown(0x51): count=4 responses=2 classes=[0x00A1:2] instances=[0x0001:2] status=[0x08:2]
  Unknown(0x4B): count=2 responses=0 classes=[0x00A1:2] instances=[0x0001:2]

Top Unknown Service+Class Pairs:
  0x4B/0x00A1 (2)
  0x51/0x00A1 (2)

Top Paths:
  0x0067/0x0001/0x0000 (13992)
  0x00A1/0x0001/0x0000 (10495)
  0x0006/0x0001/0x0000 (338)
  0x0001/0x0001/0x0000 (10)
  0x0001/0x0001/0x0064 (1)
  0x0001/0x0001/0x0065 (1)
  0x0001/0x0001/0x0066 (1)
```
